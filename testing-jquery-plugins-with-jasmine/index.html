<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

        <!-- Enable responsiveness on mobile devices-->
        <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover"
        />

        <title>Testing jQuery plugins with Jasmine | Francisco Souza</title>

        <!-- CSS -->
        <link rel="stylesheet" href="https://blog.fsouza.dev/print.css" media="print"> <link rel="stylesheet" href="https://blog.fsouza.dev/poole.css"> <link
        rel="stylesheet" href="https://blog.fsouza.dev/hyde.css">
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"
        />

         <link rel="alternate" type="application/atom+xml" title="RSS" href="https://blog.fsouza.dev/atom.xml">  

<!-- prettier ignore -->
<link rel="stylesheet" href="https://blog.fsouza.dev/custom-style.css?h=4061651ab4fa87df8bc6" />

<!-- prettier ignore -->

    </head>

    <body
        class=" layout-reverse"
    >
        
        <div class="sidebar">
            <div
                class="container sidebar-sticky"
            >
                <div class="sidebar-about">
                    
                    <a href="https:&#x2F;&#x2F;blog.fsouza.dev"
                        ><h1>Francisco Souza</h1></a
                    >
                     
                </div>

                <ul class="sidebar-nav">
                      
                </ul>
            </div>
        </div>
        

        <div class="content container">
            

<div class="post">
    <h1 class="post-title">Testing jQuery plugins with Jasmine</h1>
    <span class="post-date">May 28, 2011</span>
    <ul class="tags">
        
        <!-- prettier ignore -->
        <li>
            <a href="https://blog.fsouza.dev/tags/bdd/"
                >#bdd</a
            >
        </li>
        
        <!-- prettier ignore -->
        <li>
            <a href="https://blog.fsouza.dev/tags/jasmine/"
                >#jasmine</a
            >
        </li>
        
        <!-- prettier ignore -->
        <li>
            <a href="https://blog.fsouza.dev/tags/javascript/"
                >#javascript</a
            >
        </li>
        
        <!-- prettier ignore -->
        <li>
            <a href="https://blog.fsouza.dev/tags/jquery/"
                >#jquery</a
            >
        </li>
        
    </ul>
    <p>Since I started working at <a rel="noopener" target="_blank" href="http://globo.com">Globo.com</a>, I developed some
jQuery plugins (for internal use) with my team, and we are starting to test
these plugins using <a rel="noopener" target="_blank" href="https://pivotal.github.com/jasmine/">Jasmine</a>, <em>“a
behavior-driven development framework for testing your JavaScript code”</em>. In
this post, I will show how to develop a very simple jQuery plugin (based on an
example that I learned with <a rel="noopener" target="_blank" href="http://rdworth.org/">Ricard D. Worth</a>): zebrafy.
This plugin “zebrafies” a table, applying different classes to odd and even
lines. Let’s start setting up a Jasmine environment... First step is download
the <a rel="noopener" target="_blank" href="https://pivotal.github.com/jasmine/download.html">standalone version of
Jasmine</a>, then extract it and
edit the runner. The runner is a simple HTML file, that loads Jasmine and all
JavaScript files you want to test. But, wait... why not test using node.js or
something like this? Do I really need the browser on this test? You don’t
<strong>need</strong>, but I think it is important to test a plugin that works with the DOM
using a real browser. Let’s delete some files and lines from <em>SpecRunner.html</em>
file, so we adapt it for our plugin. This is how the structure is going to look
like:</p>
<pre><code>.
├── SpecRunner.html
├── lib
│   ├── jasmine-1.0.2
│   │   ├── MIT.LICENSE
│   │   ├── jasmine-html.js
│   │   ├── jasmine.css
│   │   └── jasmine.js
│   └── jquery-1.6.1.min.js
├── spec
│   └── ZebrafySpec.js
└── src
    └── jquery.zebrafy.js
</code></pre>
<p>You can create the files <code>jquery.zebrafy.js</code> and <code>ZebrafySpec.js</code>, but
remember: it is BDD, we need to describe
the behavior first, then write the code. So let’s start writing the specs in
<code>ZebrafySpec.js</code> file using Jasmine. If you are familiar with
<a rel="noopener" target="_blank" href="http://rspec.info">RSpec</a> syntax, it’s easy to understand how to write spec
withs Jasmine, if you aren’t, here is the clue: Jasmine is a lib with some
functions used for writing tests in an easier way. I’m going to explain each
function “on demmand”, when we need something, we learn how to use it! ;)</p>
<p>First of all, we need to start a new test suite. Jasmine provides the
<code>describe</code> function for that, this function receives a string and another
function (a callback). The string describes the test suite and the function is
a callback that delimites the scope of the test suite. Here is the <code>Zebrafy</code>
suite:</p>
<pre data-lang="javascript" class="language-javascript "><code class="language-javascript" data-lang="javascript">describe(&#x27;Zebrafy&#x27;, function () {

});
</code></pre>
<p>Let’s start describing the behavior we want to get from the plugin. The most
basic is: we want different CSS classes for odd an even lines in a table.
Jasmine provides the <code>it</code> function for writing the tests. It also receives a
string and a callback: the string is a description for the test and the
callback is the function executed as test. Here is the very first test:</p>
<pre data-lang="javascript" class="language-javascript "><code class="language-javascript" data-lang="javascript">it(&#x27;should apply classes zebrafy-odd and zebrafy-even to each other table lines&#x27;, function () {
    var table = $(&quot;#zebra-table&quot;);
    table.zebrafy();
    expect(table).toBeZebrafyied();
});
</code></pre>
<p>Okay, here we go: in the first line of the callback, we are using jQuery to
select a table using the <code>#zebra-table</code> selector, which will look up for a
table with the ID attribute equals to <em>“zebra-table”</em>, but we don’t have this
table in the DOM. What about add a new table to the DOM in a hook executed
before the test run and remove the table in another hook that runs after the
test? Jasmine provide two functions: <code>beforeEach</code> and <code>afterEach</code>. Both
functions receive a callback function to be executed and, as the names suggest,
the <code>beforeEach</code> callback is called before each test run, and the <code>afterEach</code>
callback is called after the test run. Here are the hooks:</p>
<pre data-lang="javascript" class="language-javascript "><code class="language-javascript" data-lang="javascript">beforeEach(function () {
    $(&#x27;&lt;table id=&quot;zebra-table&quot;&gt;&lt;&#x2F;table&gt;&#x27;).appendTo(&#x27;body&#x27;);
    for (var i=0; i &lt; 10; i++) {
        $(&#x27;&lt;tr&gt;&lt;&#x2F;tr&gt;&#x27;).append(&#x27;&lt;td&gt;&lt;&#x2F;td&gt;&#x27;).append(&#x27;&lt;td&gt;&lt;&#x2F;td&gt;&#x27;).append(&#x27;&lt;td&gt;&lt;&#x2F;td&gt;&#x27;).appendTo(&#x27;#zebra-table&#x27;);
    };
});

afterEach(function () {
    $(&quot;#zebra-table&quot;).remove();
});
</code></pre>
<p>The <code>beforeEach</code> callback uses jQuery to create a table with 10 rows and 3
columns and add it to the DOM. In <code>afterEach</code> callback, we just remove that
table using jQuery again. Okay, now the table exists, let’s go back to the
test:</p>
<pre data-lang="javascript" class="language-javascript "><code class="language-javascript" data-lang="javascript">it(&#x27;should apply classes zebrafy-odd and zebrafy-even to each other table lines&#x27;, function () {
    var table = $(&quot;#zebra-table&quot;);
    table.zebrafy();
    expect(table).toBeZebrafyied();
});
</code></pre>
<p>In the second line, we call our plugin, that is not ready yet, so let’s forward
to the next line, where we used the <code>expect</code> function. Jasmine provides this
function, that receives an object and executes a <em>matcher</em> against it, there is
a lot of built-in matchers on Jasmine, but <code>toBeZebrafyied</code> is not a built-in
matcher. Here is where we know another Jasmine feature: the capability to write
custom matchers, but how to do this? You can call the <code>beforeEach</code> again, and
use the <code>addMatcher</code> method of Jasmine object:</p>
<pre data-lang="javascript" class="language-javascript "><code class="language-javascript" data-lang="javascript">beforeEach(function () {
    this.addMatchers({
        toBeZebrafyied: function() {
            var isZebrafyied = true;

            this.actual.find(&quot;tr:even&quot;).each(function (index, tr) {
                isZebrafyied = $(tr).hasClass(&#x27;zebrafy-odd&#x27;) === false &amp;&amp; $(tr).hasClass(&#x27;zebrafy-even&#x27;);
                if (!isZebrafyied) {
                    return;
                };
            });

            this.actual.find(&quot;tr:odd&quot;).each(function (index, tr) {
                isZebrafyied = $(tr).hasClass(&#x27;zebrafy-odd&#x27;) &amp;&amp; $(tr).hasClass(&#x27;zebrafy-even&#x27;) === false;
                if (!isZebrafyied) {
                    return;
                };
            });

            return isZebrafyied;
        }
    });
});
</code></pre>
<p>The method <code>addMatchers</code> receives an object where each property is a matcher.
Your matcher can receive arguments if you want. The object being matched can be
accessed using <code>this.actual</code>, so here is what the method above does: it takes
all odd <code>&lt;tr&gt;</code> elements of the table (<code>this.actual</code>) and check if them have the
CSS class <code>zebrafy-odd</code> and don’t have the CSS class <code>zebrafy-even</code>, then do
the same checking with even <code>&lt;tr&gt;</code> lines.</p>
<p>Now that we have wrote the test, it’s time to write the plugin. Here some
jQuery code:</p>
<pre data-lang="javascript" class="language-javascript "><code class="language-javascript" data-lang="javascript">(function ($) {
    $.fn.zebrafy = function () {
        this.find(&quot;tr:even&quot;).addClass(&quot;zebrafy-even&quot;);
        this.find(&quot;tr:odd&quot;).addClass(&quot;zebrafy-odd&quot;);
    };
})(jQuery);
</code></pre>
<p>I’m not going to explain <a rel="noopener" target="_blank" href="http://docs.jquery.com/Plugins/Authoring">how to implement a jQuery
plugin</a> neither <a rel="noopener" target="_blank" href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">what are those
brackets on
function</a>,
this post aims to show how to use Jasmine to test jQuery plugins.</p>
<p>By convention, jQuery plugins are “chainable”, so let’s make sure the zebrafy
plugin is chainable using a spec:</p>
<pre data-lang="javascript" class="language-javascript "><code class="language-javascript" data-lang="javascript">it(&#x27;zebrafy should be chainable&#x27;, function() {
    var table = $(&quot;#zebra-table&quot;);
    table.zebrafy().addClass(&#x27;black-bg&#x27;);
    expect(table.hasClass(&#x27;black-bg&#x27;)).toBeTruthy();
});
</code></pre>
<p>As you can see, we used the built-in matcher <code>toBeTruthy</code>, which asserts that
an object or expression is <code>true</code>. All we need to do is return the jQuery
object in the plugin and the test will pass:</p>
<pre data-lang="javascript" class="language-javascript "><code class="language-javascript" data-lang="javascript">(function ($) {
    $.fn.zebrafy = function () {
        return this.each(function (index, table) {
            $(table).find(&quot;tr:even&quot;).addClass(&quot;zebrafy-even&quot;);
            $(table).find(&quot;tr:odd&quot;).addClass(&quot;zebrafy-odd&quot;);
        });
    };
})(jQuery);
</code></pre>
<p>So, the plugin is tested and ready to release! :) You can check the entire code
and test with more spec in a <a rel="noopener" target="_blank" href="https://github.com/fsouza/jquery-testing-jasmine">GitHub
repository</a>.</p>

</div>

<!-- prettier ignore -->

        </div>

         
    </body>
</html>
